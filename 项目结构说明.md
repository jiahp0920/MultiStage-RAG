MultiStage-RAG/
├── README.md                          # 项目说明文档
├── requirements.txt                   # Python依赖包
├── setup.py                          # 安装配置
├── pyproject.toml                    # 现代Python项目配置
├── configs/                          # 配置文件目录
│   ├── default_config.yaml           # 默认配置（主配置）
│   ├── development_config.yaml       # 开发环境配置
│   └── production_config.yaml        # 生产环境配置
├── src/                              # 源代码目录
│   └── multistage_rag/               # 主包
│       ├── __init__.py               # 包导出定义
│       ├── core/                     # 核心业务逻辑
│       │   ├── __init__.py           # 核心模块导出
│       │   ├── models.py             # 数据模型（Document, RetrievalResult等）
│       │   ├── pipeline.py           # 管道抽象（BaseStage, Pipeline）
│       │   └── retriever.py          # 主检索器（MultiStageRetriever）
│       ├── stages/                   # 三级检索阶段实现
│       │   ├── __init__.py           # 阶段模块导出
│       │   ├── recall.py             # 召回阶段：向量检索
│       │   ├── pre_rank.py           # 粗排阶段：BM25 + 业务规则
│       │   └── re_rank.py            # 精排阶段：重排序模型
│       ├── components/               # 可插拔组件（遵循OCP原则）
│       │   ├── __init__.py           # 组件包导出
│       │   ├── base.py               # 所有组件抽象基类
│       │   ├── factory.py            # 组件工厂主类
│       │   ├── vector_store/         # 向量存储组件
│       │   │   ├── __init__.py       # 向量存储导出
│       │   │   ├── base.py           # VectorStore基类
│       │   │   ├── chroma_store.py   # ChromaDB实现（默认）
│       │   │   ├── faiss_store.py    # FAISS实现
│       │   │   └── factory.py        # 向量存储工厂
│       │   ├── reranker/             # 重排序器组件
│       │   │   ├── __init__.py       # 重排序器导出
│       │   │   ├── base.py           # BaseReranker基类
│       │   │   ├── bailian_reranker.py # 阿里百炼实现（默认）
│       │   │   ├── bge_reranker.py   # BGE开源实现
│       │   │   └── factory.py        # 重排序器工厂
│       │   ├── rule_engine/          # 规则引擎组件
│       │   │   ├── __init__.py       # 规则引擎导出
│       │   │   ├── base.py           # BaseRule基类
│       │   │   ├── rule_engine.py    # 规则引擎主类
│       │   │   ├── recency_rule.py   # 时效性规则
│       │   │   ├── authority_rule.py # 权威性规则
│       │   │   ├── keyword_rule.py   # 关键词规则
│       │   │   ├── length_rule.py    # 长度规则
│       │   │   └── factory.py        # 规则工厂
│       │   ├── cache/                # 缓存组件
│       │   │   ├── __init__.py       # 缓存组件导出
│       │   │   ├── base.py           # BaseCache基类
│       │   │   ├── redis_cache.py    # Redis实现（默认）
│       │   │   ├── memory_cache.py   # 内存缓存实现
│       │   │   ├── null_cache.py     # 空缓存（测试用）
│       │   │   └── factory.py        # 缓存工厂
│       │   └── llm/                  # LLM组件（用于答案生成）
│       │       ├── __init__.py       # LLM组件导出
│       │       ├── base.py           # BaseLLM基类
│       │       ├── openai_llm.py     # OpenAI实现
│       │       ├── qwen_llm.py       # 通义千问实现
│       │       └── factory.py        # LLM工厂
│       ├── config/                   # 配置管理
│       │   ├── __init__.py           # 配置模块导出
│       │   ├── config_manager.py     # 配置管理器（加载、验证）
│       │   └── schema.py             # Pydantic配置模型（强类型验证）
│       ├── api/                      # RESTful API服务
│       │   ├── __init__.py           # API模块导出
│       │   ├── app.py                # FastAPI主应用
│       │   ├── schemas.py            # API请求/响应模型
│       │   └── routers/              # API路由
│       │       ├── __init__.py       # 路由模块导出
│       │       ├── retrieve.py       # 检索相关路由
│       │       ├── manage.py         # 管理相关路由
│       │       └── monitor.py        # 监控相关路由
│       ├── utils/                    # 工具函数
│       │   ├── __init__.py           # 工具模块导出
│       │   ├── logger.py             # 日志配置
│       │   ├── bm25.py               # BM25算法实现
│       │   ├── metrics.py            # 监控指标收集
│       │   └── validator.py          # 数据验证工具
│       └── cli.py                    # 命令行接口
├── tests/                            # 测试目录
│   ├── __init__.py                   # 测试包定义
│   ├── test_retriever.py             # 检索器测试
│   ├── test_components.py            # 组件测试
│   ├── test_api.py                   # API测试
│   └── conftest.py                   # 测试配置
├── examples/                         # 使用示例
│   ├── basic_usage.py                # 基础使用示例
│   ├── config_example.yaml           # 配置示例
│   ├── api_client.py                 # API客户端示例
│   └── custom_component.py           # 自定义组件示例
├── docs/                             # 文档目录
│   ├── API.md                        # API接口文档
│   ├── CONFIGURATION.md              # 配置说明文档
│   ├── EXTENSION.md                  # 扩展开发指南
│   └── DEPLOYMENT.md                 # 部署指南
└── scripts/                          # 工具脚本
    ├── setup_environment.sh          # 环境设置脚本
    ├── start_api.sh                  # API启动脚本
    └── benchmark.py                  # 性能测试脚本